### 你了解ThreadLocal吗，可以讲讲吗

> ThreadLocal是解决线程安全性的一个工具，它让每个线程都开辟了一块自己的内存空间，用来存储共享变量的一个副本。每个线程只需要去访问和操作自己的共享变量的一个副本就可以，避免了多个线程去同时竞争同一个共享资源。每个线程都拥有一个ThreadLocalMap，当线程访问ThreadLocal修饰的共享变量的时候，这个线程就会在自己的成员变量ThreadLocalMap里面去保存一份数据副本，key指向的就是ThreadLocal这个弱引用，value就是共享数据的副本，因为每个线程都有自己的数据副本，所以不存在对共享数据的并发操作，所以解决了线程安全性问题 。



### ThreadLocal会发生内存泄露吗?

> 我认为会发生内存泄露问题。主要原因是线程的私有变量ThreadLocalMap里面的key是一个弱引用，当ThreadLocal没有其他的强引用关系的时候， 所以在GC时可能会被回收掉，从而导致key变为null，造成这块内存永远无法被访问，从而出现内存泄露。
>
> 如何解决呢，我觉得有两个方法。
>
> 第一个是将ThreadLocal设置位全局变量，扩大作用域，避免被GC回收。
>
> 第二个就是每次使用完ThreadLocal后，调用remove方法去移除对应的数据。
>
> 但是用第一个方法，如果后续方法不再访问key，那么这个内存也会一直占用，也会造成内存溢出的问题。



