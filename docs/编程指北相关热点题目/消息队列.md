⾯试中会结合你项⽬使⽤的消息队列进⾏提问，记得针对性准备即可。

## 通⽤（不管是⽤的哪⼀种消息队列都可能会问到）：

### 1.为什么要⽤消息队列?

> 1. **通过异步处理提高系统性能（减少响应所需时间）**
> 2. **削峰/限流**
> 3. **降低系统耦合性。**
>
> 订单数据写入消息队列，再请求数据库，减少响应时间。

### 2.有哪些常⻅的消息队列?如何选择？

> Kafka,RocketMQ ,RabbitMQ，就用过RocketMQ 

### 3.如何保证消息不被重复消费?

> RocketMQ赋予了生产者一个唯一ID，并且每次生产消息也会产生一个唯一的ID，这样不会产生重复消息。
>
> 或者在消费端实现幂等，比如数据库主键重复，或者通过Redis实现幂等。

### 4.如何保证消息消费的顺序性?

> RocketMQ 实现了两种队列选择算法，也可以自己实现
>
> - 轮询算法
>   - 轮询算法就是向消息指定的 topic 所在队列中依次发送消息，保证消息均匀分布
>   - 是 RocketMQ 默认队列选择算法
> - 最小投递延迟算法
>   - 每次消息投递的时候统计消息投递的延迟，选择队列时优先选择消息延时小的队列，导致消息分布不均匀,按照如下设置即可。

### 5.如何保证消息的消费顺序？

> 

### 6.如何解决消息堆积问题？

> 1. 增加消费者：可以通过增加消费者的数量来提高消息的消费速度，减少消息堆积的情况。
> 2. 调整消费者的处理能力：可以优化消费者的处理逻辑，提高消费效率，减少处理时间，从而减少消息堆积的情况。
> 3. 增加MQ服务器的处理能力：可以增加MQ服务器的资源，例如增加CPU、内存等，提高MQ服务器的处理能力，从而减少消息堆积的情况。
> 4. 调整消息的持久化策略：可以根据实际需求，调整消息的持久化策略，例如将消息持久化到磁盘上，以保证消息不丢失，但可能会影响消息的处理速度。
> 5. 设置消息的过期时间：可以设置消息的过期时间，当消息超过一定时间还未被消费时，可以将其丢弃，避免消息堆积的情况。
> 6. 监控和报警：可以设置监控和报警系统，当队列中的消息堆积达到一定阈值时，及时发出报警通知，以便及时处理。

## RocketMQ：

### 1.RocketMQ 中的消息模型是什么？

> 主题模型或者发布订阅模型
>
> ![img](./消息队列.assets/16ef3837887d9a54sds.jpg)

### 2.RocketMQ 如何实现分布式事务？

>  `RocketMQ` 中使用的是 **事务消息加上事务反查机制** 来解决分布式事务问题的。
>
> ![img](./消息队列.assets/16ef38798d7a987f.png)

### 3.RocketMQ 延时消息⽤过吗？

> 定时消息仅支持在 MessageType 为 Delay 的主题内使用，即定时消息只能发送至类型为定时消息的主题中，发送的消息的类型必须和主题的类型一致。在 4.x 版本中，只支持延时消息，默认分为 18 个等级分别为：1s 5s 10s 30s 1m 2m 3m 4m 5m 6m 7m 8m 9m 10m 20m 30m 1h 2h，也可以在配置文件中增加自定义的延时等级和时长。在 5.x 版本中，开始支持定时消息，在构造消息时提供了 3 个 API 来指定延迟时间或定时时间。
>
> 基于定时消息的超时任务处理具备如下优势：
>
> - **精度高、开发门槛低**：基于消息通知方式不存在定时阶梯间隔。可以轻松实现任意精度事件触发，无需业务去重。
> - **高性能可扩展**：传统的数据库扫描方式较为复杂，需要频繁调用接口扫描，容易产生性能瓶颈。RocketMQ 的定时消息具有高并发和水平扩展的能力。
>
> **定时消息生命周期**
>
> - 初始化：消息被生产者构建并完成初始化，待发送到服务端的状态。
> - 定时中：消息被发送到服务端，和普通消息不同的是，服务端不会直接构建消息索引，而是会将定时消息**单独存储在定时存储系统中**，等待定时时刻到达。
> - 待消费：定时时刻到达后，服务端将消息重新写入普通存储引擎，对下游消费者可见，等待消费者消费的状态。
> - 消费中：消息被消费者获取，并按照消费者本地的业务逻辑进行处理的过程。 此时服务端会等待消费者完成消费并提交消费结果，如果一定时间后没有收到消费者的响应，RocketMQ 会对消息进行重试处理。
> - 消费提交：消费者完成消费处理，并向服务端提交消费结果，服务端标记当前消息已经被处理（包括消费成功和失败）。RocketMQ 默认支持保留所有消息，此时消息数据并不会立即被删除，只是逻辑标记已消费。消息在保存时间到期或存储空间不足被删除前，消费者仍然可以回溯消息重新消费。
> - 消息删除：Apache RocketMQ 按照消息保存机制滚动清理最早的消息数据，将消息从物理文件中删除。
>
> 定时消息的实现逻辑需要先经过定时存储等待触发，定时时间到达后才会被投递给消费者。因此，如果将大量定时消息的定时时间设置为同一时刻，则到达该时刻后会有大量消息同时需要被处理，会造成系统压力过大，导致消息分发延迟，影响定时精度。

### 4.RocketMQ 重试机制？

### 5.RocketMQ 刷盘机制？

> 支持同步刷盘和异步刷盘

### 6.RocketMQ 如何保证⾼可⽤？

### 7.RocketMQ 如何保证⾼性能读写？

## Kafka：

### 1.Kafka 中的消息模型是什么？

### 2.Kafka 的多副本机制了解吗？带来了什么好处？

### 3.Zookeeper 在 Kafka 中的作⽤是什么？使⽤ Kafka 能否不引⼊ Zookeeper?

### 4.Kafka 重试机制？

### 5.Kafka 刷盘机制？

### 6.Kafka 如何保证⾼可⽤？

### 7.Kafka 如何保证⾼性能读写？