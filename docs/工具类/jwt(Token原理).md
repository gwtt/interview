### 能介绍下jwt-token如何实现的吗

> 这是我在字节面试的一道真题目，估计是按照我简历出的，当时有点记忆模糊，所以答得不太好。
>
> 
>
> 首先token内容上，分为三部分
>
> head部分，payload部分，signature部分,这三个部分用.连接起来，每一部分都用base64编码
>
> **header**头部包含了声明类型和加密算法
>
> **payload**载荷存放一些用户相关信息，比如签发者，面向用户，接受方，过期时间，签发时间，唯一标识
>
> ```java
> iss: jwt 签发者
> 
> sub: jwt 所面向的用户
> 
> aud: 接收 jwt 的一方
> 
> exp: jwt 的过期时间，这个过期时间必须要大于签发时间nbf: 定义在什么时间之前，该jwt都是不可用的
> 
> iat: jwt 的签发时间
> 
> jti: jwt 的唯一身份标识，主要用来作为一次性token,从而回避重放攻击。
> ```
>
> **signature**签证，非常非常关键的部分。这关乎你的这个 Token 是否安全，是否能被人仿造。
>
> 一般是对 header (base64后的) 和 payload (base64后的) 这两部分的数据通过 secret（私钥）进行签名后的结果。
>
> 所以这个签名算法就非常关键了，常用的有 SHA256 和 HMAC和RSA。

![image-20221214125346065](jwt(Token原理)/image-20221214125346065.png)

### 假如你用Token作登录的，如何注销

> 答：jwt的缺陷是token生成后无法修改，因此无法让token失效。只能采用其它方案来弥补，基本思路如下：
>
> 1）**适当减短token有效期**，让token尽快失效
> 2）服务端对失效token进行标记，形成黑名单，虽然有违无状态特性，但是因为token有效期短，因此标记 时间也比较短。服务器压力会比较小
> 3）把JWT的id存入redis，只有redis中有id的JWT，才是有效的JWT



### Token如何防止CSRF攻击

> CSRF又称为跨站请求攻击，第三方诱导用户点击含攻击信息的网站或其他资源。
>
> 比如说用户刚刚逛完淘宝，然后留下了cookie信息，然后诈骗者利用钓鱼网站，假冒网址让用户向淘宝发送一个请求，因为cookie还遗留，就会造成非本人请求操作。
>
> 那么token如何防御了呢，首先token一般不放在cookie里面，存放在session或者localstorage里面,然后客户端每次请求都会带着token去请求，这就避免了token会被每次都带在请求中。



### Token如何实现续签

> 假设你登录完，在淘宝挑礼物，挑了好久好久哇，终于要买了，然后提示你"401，token过期，重新登录"。那可是真是草了。
>
> 首先第一个方案:
>
> 你点一个商品画面我就给你一个token，来一个请求我就给一个token。用脑子想想，不可能哇，开销太大了，垃圾方案。
>
> 第二个方案：
>
> 双token方案，一个还是短期token，另一个是长期token。客户端登录后，将 accessToken和refreshToken 保存在本地，每次访问将 accessToken 传给服务端。服务端校验 accessToken 的有效性，如果过期的话，就将 refreshToken 传给服务端。如果有效，服务端就生成新的 accessToken 给客户端。否则，客户端就重新登录即可。缺点也很明显:注销需要两个token无效化。
>
> 第三个方案:
>
> 后端每次拿到token看是不是要过期了，如果过期，重新颁发token。



### Token和jwt的区别

> 主要来说，token指的是普通令牌
>
> 其实本质来说jwt(json web token)，存放了一部分信息，无需到数据库查询，只需要用密钥校验即可，而普通token就是单纯的令牌，需要到数据库查询验证。
>
> token需要存放在服务器去辅助校验，但是jwt-token不需要。